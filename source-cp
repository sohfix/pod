#!/usr/bin/env python3
import argparse
import os
import shutil
from pathlib import Path

DEFAULT_SRC = "~/apps/pod"  # change this to your default source path
DEST_PATH = "~/Downloads/pod-backup"

def copy_source(src_dir, dest_dir):
    src_path = Path(src_dir).expanduser().resolve()
    dest_path = Path(dest_dir).expanduser().resolve()

    if not src_path.exists():
        raise FileNotFoundError(f"Source directory does not exist: {src_path}")

    dest_path.mkdir(parents=True, exist_ok=True)

    for root, dirs, files in os.walk(src_path):
        # Skip .git and __pycache__ folders
        dirs[:] = [d for d in dirs if d not in ['.git', '__pycache__']]
        # Skip .git files
        files = [f for f in files if not f.startswith('.git')]

        rel_root = Path(root).relative_to(src_path)
        target_root = dest_path / rel_root
        target_root.mkdir(parents=True, exist_ok=True)

        for file in files:
            src_file = Path(root) / file
            dest_file = target_root / file
            shutil.copy2(src_file, dest_file)
            print(f"Copied: {src_file} -> {dest_file}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Copy source files excluding .git and cache.")
    parser.add_argument("--src", default=DEFAULT_SRC, help="Source directory to copy from (default: %(default)s)")
    args = parser.parse_args()

    copy_source(args.src, DEST_PATH)
